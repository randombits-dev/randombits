<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title> · Number Localization · Random Bits</title>
  <meta name="description">
<link rel="stylesheet" href="/number-localization/_astro/formatting.5674a9f9.css" /></head>
<body>
<main-with-sidebar>
  <sidebar>
    <div class="sidebar-title">Number Localization</div>
    <a class="nav" href="/number-localization/">Intro</a>
    <a class="nav" href="/number-localization/formatting">Formatting</a>
    <a class="nav" href="/number-localization/parsing">Parsing</a>
    <a class="nav" href="/number-localization/numbering-systems">Numbering Systems</a>
    <a class="nav" href="/number-localization/locale-list">Full Locale List</a>
  </sidebar>
  <sidebar-spacing></sidebar-spacing>
  <content>
    <h1 id="number-localization---parsing-guide">Number Localization - Parsing Guide</h1>
<p>Unfortunately, the <code>Intl.NumberFormat</code> API does not have the ability to parse a number from localized string.
So in order to parse user inputs, we either need to have data for all locales and their properties, or we need to determine the properties on the fly.
Computing on the properties on the fly is a much better approach, and that is what I will show in this guide.</p>
<blockquote>
<p>As an example locale, I’m using <code>ar-DZ-u-nu-arab</code> (an arabic locale with an arabic numbering system).
This number format does not share anything in common with U.S. english.</p>
</blockquote>
<p>The following number is what we will be parsing:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> localizedString <span class="token operator">=</span> <span class="token string">&#39;-١٬٢٣٤٫٥٦&#39;</span><span class="token punctuation">;</span> <span class="token comment">// will result in -1234.56</span></code></pre>

<h2 id="replacing-the-group-and-decimal-symbols">Replacing the group and decimal symbols</h2>
<p>First we need to <strong>determine the group and decimal symbols</strong> of the locale, by formatting a test number:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span><span class="token string">&#39;ar-DZ-u-nu-arab&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formatToParts</span><span class="token punctuation">(</span><span class="token number">1111.11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> groupSymbol <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;group&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ٫</span>
<span class="token keyword">const</span> decimalSymbol <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;decimal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ٬</span></code></pre>
<p>Now that we know the symbols used by the locale, we can <strong>remove the grouping symbols</strong> and <strong>replace the decimal symbol</strong> with a period.</p>
<pre class="language-javascript"><code class="language-javascript">localizedString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Regex</span><span class="token punctuation">(</span>groupSymbol<span class="token punctuation">,</span> <span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>decimalSymbol<span class="token punctuation">,</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -١٢٣٤.٥٦</span></code></pre>
<h2 id="replacing-the-numerals">Replacing the numerals</h2>
<p>Now we need to <strong>determine the numerals</strong> used in the locale.
We do this by formatting all digits, and ordering them from 0 to 9 so that the index equals the digit.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> numerals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span><span class="token string">&#39;ar-DZ-u-nu-arab&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">useGrouping</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">9876543210</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ٠١٢٣٤٥٦٧٨٩</span></code></pre>
<p>Now we create a regular expression with the numbers:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> numeralRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Now we can replace the digits with the standard 0-9 digits:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>numeralRegex<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">group</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> numerals<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -1234.56</span></code></pre>
<h2 id="final-steps">Final steps</h2>
<p>We want to allow the use of either minus sign character (remember that some locales use a different character for the minus sign):</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[−-]\s?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span> <span class="token comment">// -1234.56</span></code></pre>
<p>Finally, we can <strong>parse to a Number</strong>. After this step, any invalid values will be <em>NaN</em>.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">Number</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// -1234.56</span></code></pre>
<h2 id="putting-it-altogether">Putting it altogether</h2>
<p>Here is what a reusable class might look like:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">NumberParser</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token literal-property property">groupSymbol</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token literal-property property">decimalSymbol</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token keyword">private</span> numerals<span class="token punctuation">;</span>
  <span class="token keyword">private</span> numeralRegex<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> readonly locale<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> parts <span class="token operator">=</span> Intl<span class="token punctuation">.</span><span class="token function">NumberFormat</span><span class="token punctuation">(</span>locale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formatToParts</span><span class="token punctuation">(</span><span class="token number">1111.11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>groupSymbol <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">part</span> <span class="token operator">=&gt;</span> part<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;group&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>decimalSymbol <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">part</span> <span class="token operator">=&gt;</span> part<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;decimal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>numerals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span>locale<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">useGrouping</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">9876543210</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>numeralRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">parse</span><span class="token punctuation">(</span>localizedNumber<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localizedNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>
      localizedNumber<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Regex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>groupSymbol<span class="token punctuation">,</span> <span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>decimalSymbol<span class="token punctuation">,</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[−-]\s?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>numeralRegex<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">group</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numerals<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
  </content>
</main-with-sidebar>
</body></html>